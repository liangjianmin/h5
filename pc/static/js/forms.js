layui.define(["form","util","user","path","utils","bank","popup","validate"],function(e){var g=layui.form,n=(layui.util,layui.user),m=layui.path,o=layui.utils,v=layui.bank,t=layui.popup,h=layui.validate;function i(t){var i=o.getQueryString("forwardurl");n.unionLogin({mobile:t.userTel,password:t.userPass,userType:t.userType,callback:function(e){$.cookie("token",e.token,{path:"/"}),$.cookie("mobile",e.mobile,{path:"/"}),$.cookie("user_type",t.userTypeStr,{path:"/"}),window.location.href=i?decodeURIComponent(i):t.userCenterPath}})}function a(t,i){n.unionGetPictureCode({callback:function(e){t.empty().append(e.image),i.val(e.time)}})}function s(t){return t.userTel?t.userTel.length<11||!/^1[3|4|5|6|7|8|9][0-9]{9}$/.test(t.userTel)?(t.$tipEl.show().text("手机号输入错误，请重新输入!"),!1):void(t.imgCode?(t.$tipEl.hide(),n.getUnionSendAuthCode({mobile:t.userTel,transactionType:t.transactionType,captchaMode:t.imgCode,captchaName:t.imgCodeName,callback:function(e){layer.msg("发送成功！"),o.cuntDown(t.cuntdownSelect,60)}})):t.$tipEl.show().text("请填写图形验证码!")):(t.$tipEl.show().text("请填写手机号!"),!1)}function u(t){return t.protocol?/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,16}$/.test(t.userPass)?(t.$tipEl.hide(),void n.unionRegister({mobile:t.userTel,password:t.userPass,authCode:t.msgCode,transactionType:t.transactionType,userType:t.userType,organizationCode:t.mechanismCode,channelKeyword:t.channelKeyword,actKeyword:t.actKeyword,inviteCode:t.inviteCode,inviteMobile:t.inviteMobile,callback:function(e){console.log(e),$.cookie("token",e.token,{path:"/"}),$.cookie("mobile",e.mobile,{path:"/"}),$.cookie("user_type",t.userTypeStr,{path:"/"}),window.location.href=m.registerSuccessUrl+"?user_type="+t.userTypeStr}})):(t.$tipEl.show().text("密码为8-16位字母与数字的组合!"),!1):(t.$tipEl.show().text("请认真阅读并同意协议!"),!1)}e("forms",{init:function(){o.isPage("/form/investor_register.html")&&this.investorRegisterPage(),o.isPage("/form/investor_login.html")&&this.investorLoginPage(),o.isPage("/form/debtor_register.html")&&this.debtorRegisterPage(),o.isPage("/form/debtor_login.html")&&this.debtorLoginPage(),o.isPage("/form/forget_pass.html")&&this.forgetPassPage(),o.isPage("/form/open_bank.html")&&this.openBankPage()},investorRegisterPage:function(){var e=o.getQueryString("invite_code"),t=o.getQueryString("invite_mobile"),i=o.getQueryString("channel");e&&$.cookie("inviteCode",e,{path:"/"}),t&&$.cookie("inviteMobile",t,{path:"/"}),i&&$.cookie("channel",i,{path:"/"}),(t||$.cookie("inviteMobile"))&&$("#invetFriendInput").val($.cookie("inviteMobile")).attr("disabled",!0);var n=$("#imgCodeSrc"),r=$("#imgCodeName");a(n,r),n.on("click",function(e){e.preventDefault(),a($(this),r)}),$("#getCode").on("click",function(e){e.preventDefault(),s({$tipEl:$("#formTip"),userTel:$("#userMobile").val(),imgCode:$("#imgCode").val(),imgCodeName:r.val(),transactionType:"register",cuntdownSelect:"#getCode"})}),$("#invetFriend").on("click",function(e){e.preventDefault(),$("#invetFriendInput").slideToggle()}),g.on("submit(registerForm)",function(e){var t=e.field;return u({$tipEl:$("#formTip"),protocol:t.proprotol,userPass:t.user_pass,userTel:t.user_tel,msgCode:t.msg_code,transactionType:"register",userType:1,channelKeyword:$.cookie("channel"),invetCode:$.cookie("inviteCode"),userTypeStr:"INVESTOR"}),!1})},investorLoginPage:function(){g.on("submit(registerLogin)",function(e){var t=e.field;return i({userTel:t.user_tel,userPass:t.user_pass,userType:1,userTypeStr:"INVESTOR",userCenterPath:m.investUserCenterUrl}),!1})},debtorRegisterPage:function(){var e=$("#imgCodeSrc"),t=$("#imgCodeName");a(e,t),e.on("click",function(e){e.preventDefault(),a($(this),t)}),$("#getCode").on("click",function(e){e.preventDefault(),s({$tipEl:$("#formTip"),userTel:$("#userMobile").val(),imgCode:$("#imgCode").val(),imgCodeName:t.val(),transactionType:"register",cuntdownSelect:"#getCode"})}),g.on("submit(registerForm)",function(e){var t=e.field;return u({$tipEl:$("#formTip"),protocol:t.proprotol,userPass:t.user_pass,userTel:t.user_tel,msgCode:t.msg_code,transactionType:"register",userType:2,mechanismCode:t.mechanism_code,userTypeStr:"BORROWERS"}),!1})},debtorLoginPage:function(){g.on("submit(registerLogin)",function(e){var t=e.field;return i({userTel:t.user_tel,userPass:t.user_pass,userType:2,userTypeStr:"BORROWERS",userCenterPath:m.debtorUserCenterUrl}),!1})},forgetPassPage:function(){var e=$("#imgCodeSrc"),t=$("#imgCodeName");a(e,t),e.on("click",function(e){e.preventDefault(),a($(this),t)}),$("#getCode").on("click",function(e){e.preventDefault(),s({$tipEl:$("#formTip"),userTel:$("#userMobile").val(),imgCode:$("#imgCode").val(),imgCodeName:t.val(),transactionType:"find_password"})}),g.on("submit(forgetpassForm)",function(e){var t=e.field;if(!/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,16}$/.test(t.user_new_pass))return layer.msg("密码为8-16位字母与数字的组合!"),!1;var i=o.getQueryString("user_type");return n.unionFindPassword({mobile:t.user_tel,authCode:t.user_tel_code,newPassword:t.user_new_pass,newPasswordRe:t.user_new_pass_re,callback:function(e){window.location.href=m.forgetPassSuccess+"?user_type="+i}}),!1})},openBankPage:function(){$("#checkBankLimit").on("click",function(e){e.preventDefault(),t.bankListLayer()}),v.getBankList({callback:function(e){if(0<e.length){for(var t='<option value="">请选择开户银行</option>',i=0;i<e.length;i++)0<e[i].order&&(t+='<option value="'+e[i].name+'" data-limit="'+e[i].bankLimit+'">'+e[i].name+"</option>");$("#selectBank").empty().append(t),g.render("select")}}});var u=$("#formTip"),o=$("#userName"),a=$("#userID"),s=$("#selectBank"),l=$("#userCardNo"),c=$("#userBankTel"),d=$("#openBankBtn");function p(e,t){e.show().text(t)}function f(){var e=o.val(),t=a.val(),i=l.val(),n=c.val(),r=s.val();e&&t&&i&&n&&r?d.removeClass("disabled").attr("disabled",!1):d.addClass("disabled").attr("disabled",!0)}o.on("blur",function(e){e.preventDefault();var t=$(this).val();return t?h.isChinaName(t)?void u.hide():(p(u,"输入的姓名有误！"),!1):(p(u,"请输入真实姓名！"),!1)}),a.on("blur",function(e){e.preventDefault();var t=$(this).val();return t?h.isIdCard(t)?void u.hide():(p(u,"输入的身份证号有误！"),!1):(p(u,"请输入身份证号！"),!1)}),l.on("blur",function(e){e.preventDefault();var t=$(this).val();return t?h.isBankCard(t)?void u.hide():(p(u,"输入的银行卡号有误！"),!1):(p(u,"请输入银行卡号！"),!1)}),c.on("blur",function(e){e.preventDefault();var t=$(this).val();return t?h.isTel(t)?void u.hide():(p(u,"输入的银行预留手机号有误！"),!1):(p(u,"请输入银行预留手机号！"),!1)}),o.on("input",function(e){e.preventDefault(),f()}),a.on("input",function(e){e.preventDefault(),f()}),l.on("input",function(e){e.preventDefault(),f()}),c.on("input",function(e){e.preventDefault(),f()}),g.on("select(bankSelect)",function(e){var t=e.value,i=e.elem,n=[];if(t){for(var r=0;r<i.length;r++)$(i[r]).val()===t&&(n=$(i[r]).data("limit").split("/"));1<n.length?$("#bankLimitInfo").show().text("快捷支付限额：单笔"+n[0]+"，单日"+n[1]):$("#bankLimitInfo").show().text("快捷支付限额：单笔"+n[0]+"，单日"+n[0]),f()}else $("#bankLimitInfo").hide()}),g.on("submit(openBnak)",function(e){console.log(e);var t=e.field,i=t.user_name,n=t.user_id,r=t.user_bank_card_no,o=t.user_bank_tel,a=t.bank_name;if(!i)return p(u,"请输入真实姓名！"),!1;if(!h.isChinaName(i))return p(u,"输入的姓名有误！"),!1;if(!n)return p(u,"请输入身份证号！"),!1;if(!h.isIdCard(n))return p(u,"输入的身份证号有误！"),!1;if(!a)return p(u,"请选择开户银行！"),!1;if(!r)return p(u,"请输入银行卡号！"),!1;if(!h.isBankCard(r))return p(u,"输入的银行卡号有误！"),!1;if(!o)return p(u,"请输入银行预留手机号！"),!1;if(!h.isTel(o))return p(u,"输入的银行预留手机号有误！"),!1;var s=m.openBankRedirectUrl+m.openBankSuccessUrl;return userRole=$.cookie("user_type"),v.openBank({redirectUrl:s,userRole:userRole,realName:i,idCardNo:n,bankcardNo:r,mobile:o}),!1})}})});