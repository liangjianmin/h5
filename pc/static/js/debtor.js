layui.define(["element","form","laypage","util","user","path","utils","bank","popup","laydate"],function(e){var n=layui.element,m=layui.form,o=layui.laypage,i=layui.util,l=layui.user,f=layui.path,t=layui.utils,_=layui.bank,c=layui.popup;layui.laydate;e("debtor",{init:function(){t.isPage("/debtor/user_info.html")&&this.userInfoPage(),t.isPage("/debtor/user_trade_in.html")&&this.tradeInPage(),t.isPage("/debtor/user_trade_out.html")&&this.tradeOutPage(),t.isPage("/debtor/user_record.html")&&this.recordPage(),t.isPage("/debtor/user_repayment.html")&&this.repaymentPage(),t.isPage("/debtor/user_loan_details.html")&&this.loanDetailsPage(),t.isPage("/debtor/user_application.html")&&this.applicationPage(),t.isPage("/debtor/user_capital_details.html")&&this.capitalDetailsPage(),t.isPage("/debtor/user_setting.html")&&this.settingPage(),t.isPage("/debtor/user_depository_account.html")&&this.depositoryAccountPage(),t.isPage("/debtor/user_sign.html")&&this.userSignPage(),t.isPage("/debtor/user_bank_card.html")&&this.bankCardPage(),t.isPage("/debtor/user_pass_change.html")&&this.passChangePage(),t.isPage("/debtor/user_tel_authentication.html")&&this.telAuthenticationPage(),t.isPage("/debtor/user_tel_change.html")&&this.telChangePage(),t.isPage("/debtor/user_unbind_card_step.html")&&this.unbingCardStepPage(),t.isPage("/debtor/user_msg.html")&&this.msgPage()},userInfoPage:function(){l.debtorDetail({callback:function(e){!function(e){var t=e.user.srbank.is_srbank_user,a=e.user.bankcard_status,n=e.user.mobile;n=n.substr(0,3)+"****"+n.substr(7);for(var i=e.availableMoney_format?e.availableMoney_format:"0.00",r=e.all_not_repay,s=r.payment_amount?r.payment_amount:"0.00",o=r.principal_amount?r.principal_amount:"0.00",l=r.interest_amount?r.interest_amount:"0.00",d=e.today_not_repay,c=d.payment_amount?d.payment_amount:"0.00",u=d.list,p="",b=0;b<u.length;b++)p+='<dl class="order-wrapper"><dt class="order-tit">借款订单<span>'+u[b].order_id+'</span><b class="status">待还款</b></dt><dd class="order-cont"><ul class="order-detail clearfix"><li class="order-item order-item01 fl"><span class="tit">当期应还<span class="tip-icon"><i class="tip-text">包含当期本息、逾期本息及逾期罚息</i></span></span><br /><span class="cont">'+u[b].loan_amount+'元</span></li><li class="order-item order-item02 fl"><span class="tit">当期还款日</span><br /><span class="cont">'+u[b].payment_date+"（"+u[b].period+'）</span></li><li class="order-item order-item03 fl"><span class="tit">应还本息</span><br /><span class="cont">'+u[b].principal+'元</span></li><li class="order-item order-item04 fl"><span class="tit">逾期罚息</span><br /><span class="cont">0.00元</span></li><li class="order-item order-item05 fl"><a href="javascript:;">立即还款</a></li></ul></dd></dl>';t&&$("#isBankUser").addClass("user-icon-bank-s");"UNBIND"!==a&&$("#isBindCard").addClass("user-icon-card-s");$("#userMobile").text(n),$("#availableMoney").text(i),$("#paymentAmount").text(s),$("#principalAmount").text(o),$("#interestAmount").text(l),$("#todayPaymentAmount").text(c),$("#notRepayList").empty().append(p)}(e),e.user.srbank.is_srbank_user||($("#tradeInBtn, #tradeOutBtn").on("click",function(e){e.preventDefault(),c.openTips02Layer("BORROWERS")}),$.cookie("is_open_bank_layer")||($.cookie("is_open_bank_layer",1),c.bankTipLayer("BORROWERS")))}})},tradeInPage:function(){_.tradeInPage(function(l){var e=l.user,d=e.srbank,t=d.is_srbank_user,a=d.is_srbank_user_bindcard,n=e.bankcard_status,i=d.need_reset_pwd_first;d.is_srbank_user_sign_auto_bid,d.is_srbank_user_sign_credit_transfer,d.is_srbank_user_sign_transfer;_.validateBank({validata:{signAutoBid:!1},isSrbankUser:t,srbankUserCallback:function(){c.bankTipLayer("BORROWERS")},isSrbankUserBindcard:a,bankcardStatus:n,bindCardCallback:function(){},isNeedRestPWD:i,resetPWDCallback:function(){},validataSuccessCallback:function(){!function(e){var t=e.user,a=t.srbank.bankcard,n=t.available_total_money,i=a.bankName,r=a.bankcardNo_e,s=a.img_logo_url,o=a.bankLimit.split("/");$("#userAbailableAmont").text(n),$("#bankImg").css({"background-image":"url("+s+")"}),$("#bankName").text(i),$("#bankNo").text(r),$("#bankOneLimit").text(o[0]),$("#bankDateLimit").text(o[1]),$("#bankMonthLimit").text(o[2]);var l=function(e){var t="",a=[];for(var n in e)a.push(e[n]);for(var n=0;n<a.length;n++)0<a[n].order&&(t+='<li class="bank-list" data-code="'+a[n].bankcode+'" data-bankname="'+a[n].name+'"><img src="'+a[n].img_all_url+'" alt=""></li>');return t}(e.payway.WEB.banks);$("#WEB_lists").empty().append(l),$("#bankTransferName").text(i),$("#bankTransferNo").text(r)}(l);var a,n,i,r,s,o,e=d.bankcard.bankcode,t=f.openBankRedirectUrl+f.debtorTradeInResultUrl;a=e,n=t,$("#tradeInQuickMoney").on("keyup",function(e){e.preventDefault();var t=$("#tradeInQuickBtn"),a="is-disabled",n=1*$(this).val();100<=n?t.removeClass(a).attr({disabled:!1}):(layer.tips("充值金额不能低于100元","#tradeInQuickMoney"),t.addClass(a).attr({disabled:!0}))}),m.on("submit(tradeInQuick)",function(e){var t=e.field.trade_in_money;return _.tradeIn({amount:t,rechargeWay:"SWIFT",bankcode:a,redirectUrl:n,callback:function(e){window.location.href=e}}),!1}),i=t,r=$("#tradeInWebMoney"),s=$("#tradeInWebBtn"),o="is-disabled",$("body").on("click","#WEB_lists li.bank-list",function(e){e.preventDefault(),$(this).addClass("is-select").siblings().removeClass("is-select");var t=1*r.val(),a=$(this).data("code");100<=t&&a?s.removeClass(o).attr({disabled:!1}):s.addClass(o).attr({disabled:!0})}),$("#tradeInWebMoney").on("keyup",function(e){e.preventDefault();var t=1*$(this).val(),a=$("#WEB_lists .bank-list.is-select").data("code");100<=t&&a?s.removeClass(o).attr({disabled:!1}):(t<100&&layer.tips("充值金额不能低于100元","#tradeInWebMoney"),s.addClass(o).attr({disabled:!0}))}),m.on("submit(tradeInWeb)",function(e){var t=e.field.trade_in_web_money,a=$("#WEB_lists .bank-list.is-select").data("code");return _.tradeIn({amount:t,rechargeWay:"WEB",bankcode:a,redirectUrl:i,callback:function(e){window.location.href=e}}),!1})}}),$("#openBankList").on("click",function(e){e.preventDefault();var t=$("#WEB_lists"),a=$(this);a.data("open")?(t.css({overflow:"hidden"}),a.html('展开<i class="icon"></i>'),a.data("open","")):(t.css({overflow:"inherit"}),a.html('收起<i class="icon open"></i>'),a.data("open",!0))}),$("#bankTransferInfoBtn").on("click",function(e){e.preventDefault(),c.banktransferInfoLayer()});var r=new Clipboard("#copyGSName");r.on("success",function(e){layer.msg("复制成功！")}),r.on("error",function(e){layer.msg("复制失败，您可以使用手动复制!")});var s=new Clipboard("#copyYHName");s.on("success",function(e){layer.msg("复制成功！")}),s.on("error",function(e){layer.msg("复制失败，您可以使用手动复制!")});var o=new Clipboard("#copyYHNo");o.on("success",function(e){layer.msg("复制成功！")}),o.on("error",function(e){layer.msg("复制失败，您可以使用手动复制!")})}),$("#bankLimitBtn").on("click",function(e){e.preventDefault(),c.bankListLayer()})},tradeOutPage:function(){_.tradeOutPage(function(p){var e=p.user,b=e.srbank,t=b.is_srbank_user,a=b.is_srbank_user_bindcard,n=e.bankcard_status,i=b.need_reset_pwd_first;b.is_srbank_user_sign_auto_bid,b.is_srbank_user_sign_credit_transfer,b.is_srbank_user_sign_transfer;_.validateBank({validata:{signAutoBid:!1},isSrbankUser:t,srbankUserCallback:function(){c.bankTipLayer("BORROWERS")},isSrbankUserBindcard:a,bankcardStatus:n,bindCardCallback:function(){},isNeedRestPWD:i,resetPWDCallback:function(){},validataSuccessCallback:function(){var e,t,a,n,i,r,s,o;e=p.user.srbank,t=e.bankcard,a=e.availableAmount,n=t.bankName,i=t.bankcardNo,r=t.img_logo_url,s=t.realName_e,o=i.replace(/^(\d{4})(\d*)(\d{4})$/,"$3"),$("#availableAmount").text(a),$("#bankName").text(n).css({"background-image":"url("+r+")"}),$("#bankNo").text(i),$("#bankUser").text(s),$("#bankCardNo").text(o);var l,d=1*b.availableAmount;l=d,$("#tradeOutInput").on("input propertychange",function(e){e.preventDefault();var t=$("#tradeOutBtn"),a=1*$(this).val();return $("#getMoney").text(a),a<100?(layer.tips("提现金额不可低于100元","#tradeOutInput"),t.attr({disabled:!0}).addClass("is-disabled"),!1):l<a?(layer.tips("超出可提现金额！","#tradeOutInput"),t.attr({disabled:!0}).addClass("is-disabled"),!1):void t.attr({disabled:!1}).removeClass("is-disabled")}),$("#tradeOutAllBtn").on("click",function(e){if(e.preventDefault(),$("#tradeOutInput").val(d),$("#getMoney").text(d),d<100)return layer.tips("提现金额不可低于100元","#tradeOutInput"),!1;$("#tradeOutBtn").attr({disabled:!1}).removeClass("is-disabled")});var c,u=f.openBankRedirectUrl+f.tradeOutSuccessUrl+"user_type=borrowers";c=u,m.on("submit(tradeOutForm)",function(e){var t=e.field.trade_out_money;return _.tradeOut({amount:t,redirectUrl:c,callback:function(e){window.location.href=e}}),!1})}})})},recordPage:function(){var i='<tr class="empty"><td colspan="7">空空如也...</td></tr>',n=$("#recordTable");function r(e,t,a,n){l.debtorLoanList({page:e,pageSize:t,type:a,callback:function(e){n(e)}})}function s(e){var t=e.type_count,a=function(e){var t="",a=e.length;if(0<a)for(var n=0;n<a;n++)t+="<tr><td>"+e[n].source_order_code+"</td><td>"+e[n].c_time+"</td><td>"+e[n].loan_amount+"元</td><td>"+e[n].loan_period+"月</td><td>"+e[n].interest_rate+"%</td><td>"+e[n].repay_type+"</td><td>"+e[n].status+"</td></tr>";else t=i;return t}(e.list);$("#auditCount").text(t.audit_total),$("#collectCount").text(t.collect_total),$("#releasedCount").text(t.released_total),n.empty().append(a)}function a(a,n){1<a.maxPage&&o.render({elem:"recordPage",count:a.total,limit:a.limit,groups:10,layout:["prev","page","next","skip"],theme:"#ff6600",jump:function(e,t){t||r(e.curr,e.limit,n,function(){s(a)})}})}r(1,10,1,function(e){s(e),a(e,1)}),$("#recordTypeLists").on("click",".js-record-type",function(){var t=$(this).data("type");$(this).addClass("is-select").siblings().removeClass("is-select"),r(1,10,t,function(e){s(e),a(e,t)})})},repaymentPage:function(){var n=$("#repaymentTable");function i(e,t,a,n){l.debtorLoanScheduleList({page:e,pageSize:t,type:a,callback:function(e){n(e)}})}function r(e){var t=e.type_count,a=function(e){var t="";console.log(e);var a=e.length,n="";if(0<a)for(var i=0;i<a;i++)n=0<e[i].repay_status?'<a class="btn-back" href="javascript:;">立即还款</a>':"未到期",t+='<tr><td><a class="btn-back" href="'+f.debtorRepaymentDetailUrl+e[i].loan_id+'">'+e[i].source_order_code+"</a></td><td>"+e[i].loan_amount+"元</td><td>"+e[i].wait_repay+"元</td><td>"+e[i].haved_repay+"元</td><td>"+e[i].repay_date+"<br />("+e[i].current_schedule+"/"+e[i].loan_period+"期)</td><td>"+e[i].now_repay+"元</td><td>"+e[i].status+"</td><td>"+n+"</td></tr>";else t='<tr class="empty"><td colspan="8">空空如也...</td></tr>';return t}(e.list);$("#repayCount").text(t.repay_total),$("#earlyCount").text(t.early_total),$("#overdueCount").text(t.overdue_total),n.empty().append(a)}function a(a,n){1<a.maxPage&&o.render({elem:"recordPage",count:a.total,limit:a.limit,groups:10,layout:["prev","page","next","skip"],theme:"#ff6600",jump:function(e,t){t||i(e.curr,e.limit,n,function(){r(a)})}})}i(1,10,3,function(e){r(e),a(e,3)}),$("#repaymentTypeLists").on("click",".js-repayment-type",function(){var t=$(this).data("type");$(this).addClass("is-select").siblings().removeClass("is-select"),i(1,10,t,function(e){r(e),a(e,t)})})},loanDetailsPage:function(){var e=t.getQueryString("loan_id");l.loanScheduleDetail({loanId:e,callback:function(a){!function(e){console.log(e);var t=e.loan_info;$("#loanOrder").text(t.source_order_code),$("#statusTxt").text(t.status_txt),$("#orderTime").text(t.c_time),$("#loanAmount").text(t.loan_amount),$("#loanPeriod").text(t.loan_period),$("#loanRate").text(t.interest_rate+"%"),$("#loanType").text(t.repay_type),$("#waitPayment").text(t.wait_payment+"元"),$("#interestDate").text(t.interest_date),$("#havedPayment").text(t.haved_payment+"元"),$("#endTime").text(t.end_time),$("#totalDefaultInterest").text(t.total_default_interest+"元");for(var a=e.wait_repay_list,n=a.length,i="",r=0;r<n;r++){if(a[r].repay_status)var s='<a class="btn-back btn-back-default" href="javascript:;">立即还款</a>';else var s='<a class="btn-back" href="javascript:;">待还款</a>';i+='<div class="details-info wating-back-info"><ul class="wating-back-lists clearfix"><li class="list-item list-item01"><div class="list-tit">当期应还</div><div class="list-text">'+a[r].payment+'元</div></li><li class="list-item list-item02"><div class="list-tit">当期还款日</div><div class="list-text">'+a[r].payment_date+"（"+a[r].sequence+"/"+a[r].loan_period+'期）</div></li><li class="list-item list-item03"><div class="list-tit">应还本息</div><div class="list-text">'+a[r].payment+'元</div></li><li class="list-item list-item04"><div class="list-tit">逾期罚息</div><div class="list-text">'+a[r].default_interest+'元</div></li><li class="list-item list-item05">'+s+"</li></ul></div>"}$("#waitRepayListWrapper").empty().append(i);for(var o=e.schedule_list,l=o.length,d="",c="",r=0;r<l;r++){if(c=o[0].manage_fee_rate,console.log(o[r]),"已还款"===o[r].status_txt)var u="back-success";else var u="";d+='<tr class="'+u+'"><td>'+o[r].sequence+"/"+o[r].loan_period+"期</td><td>"+o[r].payment_date+"</td><td>"+o[r].payment+"元</td><td>"+o[r].principal+"元</td><td>"+o[r].interest+"元</td><td>"+o[r].status_txt+"</td></tr>"}$("#scheduleTable").empty().append(d),$("#yearRate").text(c+"%")}(a),$("#protocolLayer").on("click",function(e){e.preventDefault();var t=function(e){var t="";if(e){for(var t='<table class="layui-table protocol-table"><thead><tr><th>序号</th><th>出借人</th><th>出借金额</th><th>合同协议</th></tr></thead><tbody>',a=0;a<e.length;a++)t+="<tr><td>"+(a+1)+"</td><td>"+e[a].show_name+"</td><td>"+e[a].amount+'元</td><td><a class="check-protocol js-protocol" href="javascript:;" data-url="'+e[a].contract_url+'">查看</a></td></tr>';t+="</tbody></table>"}else t='<tr class="empty"><td colspan="4">空空如也...</td></tr>';return t}(a.contracts);layer.open({type:1,content:t,area:["630px","auto"],move:!1,resize:!1,skin:"dl__layer loan-protocol-layer",title:"借款协议",success:function(e,t){$(".js-protocol").on("click",function(e){e.preventDefault();var t=$(this).data("url");c.protocolLayer("借款协议",t)})}})})}})},applicationPage:function(){for(var e='<option value="">请选择</option>',t=1;t<=36;t++)e+='<option value="'+t+'">'+t+"个月</option>";$("#selectDate").empty().append(e),_.getBankList({callback:function(e){if(0<e.length){for(var t='<option value="">请选择</option>',a=0;a<e.length;a++)0<e[a].order&&(t+='<option value="'+e[a].name+'">'+e[a].name+"</option>");$("#selectBank").empty().append(t),m.render("select")}}});treeSelect({s1:"provids",s2:"cityids",s3:"areaids",v1:null,v2:null,v3:null}),m.on("submit(applicationForm)",function(e){var t=e.field,a=$("#selectProvid input").val(),n=$("#selectCityid input").val(),i=$("#selectAreaid input").val(),r=$("#selectProvids input").val(),s=$("#selectCityids input").val(),o=$("#selectAreaids input").val();return l.srbankEstablishLoan({realName:t.debtor_name,idCardNo:t.debtor_id,loanAmount:t.debtor_money,loanPeriod:t.debtor_date,loanRemark:t.debtor_use,bankNum:t.debtor_bank_no,bankName:t.debtor_bank,sex:t.debtor_sex,eduExperience:t.debtor_school,mobileTelephone:t.debtor_tel,nativeplace:a,villagetown:n,street:i,community:t.debtor_address,familyAdd:r,countryside:s,villagecenter:o,plot:t.debtor_address02,callback:function(e){c.applicationLayer()}}),!1})},capitalDetailsPage:function(){function n(e,t,a,n){l.debtorFundList({page:e,pageSize:t,detailType:a,callback:function(e){n(e)}})}function i(e){var t=function(e){var t="",a=e.length;if(0<a)for(var n=0;n<a;n++)t+="<tr><td>"+e[n].time+"</td><td>"+e[n].type+"</td><td>"+e[n].money+"</td><td>0.00元</td><td>"+e[n].remark+"</td></tr>";else t='<tr class="empty"><td colspan="5">空空如也...</td></tr>';return t}(e.list);$("#capitalTable").empty().append(t)}function a(e,a){1<e.maxPage&&o.render({elem:"capitalPage",count:e.list.length,limit:10,groups:10,layout:["prev","page","next","skip"],theme:"#ff6600",jump:function(e,t){t||n(e.curr,10,a,function(e){i(e)})}})}n(1,10,"borrow",function(e){i(e),a(e,"borrow")}),$("#debotrTypeLists").on("click",".js-debtor-type",function(){var t=$(this).data("type");$(this).addClass("is-select").siblings().removeClass("is-select"),n(1,10,t,function(e){i(e),a(e,t)})})},settingPage:function(){_.getBankInformation({callback:function(e){var t=e.user,a=t.srbank.is_srbank_user;!function(e){var t=e.srbank,a=t.is_srbank_user,n=t.is_srbank_user_sign_borrower,i=e.bankcard_status;if(a){var r=t.card_no_e,s=t.mobile_e,o=t.name_e,l=t.cert_no_e;if($("#bankIcon").addClass("icon-bank-s"),$("#bankCardNo").text(r),$("#bankBtn").text("查看").attr({href:f.debtorUserBank}),n&&$("#bankSignIcon").addClass("icon-sign-s"),"UNBIND"!==i){var d=t.bankcard.bankcardNo.replace(/^(\d{4})(\d*)(\d{4})$/,"$3");$("#cardIcon").addClass("icon-card-s"),$("#bankCard").text("尾号"+d+" | "+o+" | "+l),$("#bankCardBtn").text("查看").attr({href:f.debtorUserBankCard})}$("#userTel").text(s),$("#userPass02").addClass("icon-pass02-s")}else $("#bankBtn").on("click",function(e){e.preventDefault();var t=f.openBankRedirectUrl+f.openBankSuccessUrl;_.openBank({redirectUrl:t,userRole:"BORROWERS"})}),$("#bankCardBtn, #checkSignBtn").on("click",function(e){e.preventDefault(),c.openTips02Layer("BORROWERS")})}(t),$("#resetPassBtn").on("click",function(e){e.preventDefault();var t=f.debtorUserCenterUrl;a?_.resetPass({redirectUrl:t,authCode:"",needCheck:!1,callback:function(e){window.location.href=e}}):c.openTips02Layer("BORROWERS")})}})},depositoryAccountPage:function(){_.getBankInformation({callback:function(e){var t=e.user.is_organization,a=e.user.srbank,n=a.card_no_e,i=a.name_e,r=a.cert_no_e,s=a.mobile_e,o=a.customer_no?a.customer_no:"",l=$("#no_organization"),d=$("#organization");n=n.replace(/(.{4})/g,"$1 "),o=o.replace(/^(\d{4})(\d*)(\d{4})$/g,"$1****$3"),$("#bankCardNo").text(n),$(".js-bank-name").text(i),$(".js-bank-id").text(r),$(".js-bank-tel").text(s),$("#bank_custom_no").text(o),t?(d.show(),l.remove()):(l.show(),d.remove())}})},userSignPage:function(){_.getBankInformation({callback:function(e){e.user.srbank.is_srbank_user_sign_borrower?($("#signBtn").remove(),$("#isSign").show()):($("#signBtn").show(),$("#isSign").remove(),$("#signBtn").on("click",function(e){e.preventDefault();var t=f.debtorUserCenterUrl;_.sign({signType:"sign_borrower",redirectUrl:t,callback:function(e){window.location.href=e}})}))}})},bankCardPage:function(){_.getBankInformation({callback:function(e){var t=e.user.srbank,a=e.user.bankcard_status,n=t.bankcard.bankcardNo_e,i=t.bankcard.mobile_e,r=$("#bindCard"),s=$("#unbindingCard"),o=$("#unbindCard");"BIND"===a?($(".js-card-no").text(n),$(".js-card-tel").text(i),r.show()):"UNBINDING"===a?($(".js-card-no").text(n),s.show()):o.show()}}),$("#saveCard").on("click",function(e){e.preventDefault(),c.saveCardLayer()})},passChangePage:function(){m.on("submit(changePassFrom)",function(e){var t=e.field;return t.now_pass?l.unionUpdatePassword({oldPassword:t.now_pass,newPassword:t.new_pass,newPasswordRe:t.re_new_pass,callback:function(e){c.changePassLayer("密码修改成功",function(e,t){$.cookie("token",null,{expires:0,path:"/"}),$.cookie("mobile","",{expires:0,path:"/"}),$.cookie("user_type","",{expires:0,path:"/"}),window.location.href=f.debtorLoginUrl})}}):layer.msg("密码为8-16位字母与数字的组合!"),!1})},telAuthenticationPage:function(){var e=$.cookie("mobile");$("#userTel").text(e)},telChangePage:function(){$("#getCode").on("click",function(e){e.preventDefault();var t=$("#userTel").val();l.getUnionSendAuthCode({mobile:t,transactionType:"update_mobile",callback:function(e){layer.msg("发送成功！");var t=(new Date).getTime(),a=t+59e3;i.countdown(a,t,function(e,t,a){var n=e[3]<10?"0"+e[3]:e[3];n<=0?layui.$("#getCode").text("获取验证码").attr("disabled",!1).removeClass("is-disabled"):layui.$("#getCode").text(n+"s后重新获取").attr("disabled",!0).addClass("is-disabled")})}})}),m.on("submit(changeTelFrom)",function(e){var t=e.field;return l.unionChangeMobile({mobile:t.user_tel,authCode:t.user_code,transactionType:"update_mobile",callback:function(e){c.changePassLayer("手机号修改成功",function(e,t){$.cookie("token",null,{expires:0,path:"/"}),$.cookie("mobile","",{expires:0,path:"/"}),$.cookie("user_type","",{expires:0,path:"/"}),window.location.href=f.debtorLoginUrl})}}),!1})},unbingCardStepPage:function(){_.unbindBankcardPage({callback:function(e){var n=e.user;$("#userCardName").text(n.realName),$("#userName").val(n.realName),$("#userID").val(n.idCardNo.replace(/^(\d{4})(\d*)(\d{4})$/,"$1****$3")),$("#userTel").val(n.mobile),$("#getCode").on("click",function(e){$(this);var t=(new Date).getTime(),a=t+59e3;i.countdown(a,t,function(e,t,a){var n=e[3]<10?"0"+e[3]:e[3];n<=0?layui.$("#getCode").val("获取验证码").attr("disabled",!1).removeClass("is-disabled"):layui.$("#getCode").val(n+"s后重新获取").attr("disabled",!0).addClass("is-disabled")}),e.preventDefault(),_.sendPhoneYzm({phoneNum:n.mobile,type:"update_mobile",checkMobile:0,callback:function(e){layer.msg("发送成功！")}})}),m.on("submit(unbindForm01)",function(e){var t=e.field;return _.unbindBankcardCheck({verifyCode:t.user_code,bankcardno:t.user_card_no,mobile:t.user_tel,callback:function(e){$("#inputForm").remove(),$("#uploadIDForm").show()}}),!1}),$("#uploadImgBtn").on("click",function(e){e.preventDefault(),$("#upload_img").attr("src")||layer.tips("请添加照片","#uploadImgBtn")}),$(".upload_images").on("change",function(){lrz(this.files[0],{width:400},function(e){var t=e.base64,a=e.origin.name,n=t.split(",")[1],i=a.split("."),r=i[i.length-1];$("#upload_img").show().attr("src",t),$(".change-upload01").hide(),$(".change-upload02").show().css({"z-index":1e4}),$("#uploadImgBtn").off("click").on("click",function(e){e.preventDefault(),_.unbindBankcardApply({imgbase64:n,type:r,callback:function(e){$("#upload_img").attr("src",e.img_path);var t=f.debtorUserBankCard;c.uploadImgLayer(t)}})})})})}})},msgPage:function(){function a(e){var t=function(e){var t="",a=e.length;if(0<a)for(var n=0;n<a;n++){if(e[n].is_read)var i="is-ready";else var i="";t+='<div class="layui-colla-item '+i+'" data-id="'+e[n].id+'" data-isRead="'+e[n].is_read+'"><h2 class="layui-colla-title clearfix"><span class="msg-tit">'+e[n].subject+'</span><span class="msg-time fr">'+e[n].time+'</span></h2><div class="layui-colla-content">'+e[n].content+"</div></div>"}else t='<div class="empty empty-div"><span>空空如也...</span></div>';return t}(e.list);$("#userMsgList").empty().append(t),m.render(),n.render()}l.getNotes({page:1,pageSize:10,callback:function(e){var t;a(e),1<(t=e).maxPage&&o.render({elem:"noticePage",count:t.total,limit:t.limit,groups:10,layout:["prev","page","next","skip"],theme:"#ff6600",jump:function(e,t){t||l.getNotes({page:e.curr,pageSize:e.limit,callback:function(e){a(e)}})}})}}),$("body").on("click","#userMsgList .layui-colla-item",function(){var e=$(this).data("isread"),t=$(this).data("id");$(this).addClass("is-ready"),$(this).find(".layui-form-checkbox").addClass("layui-form-checked"),e||l.isReadyNotice({ids:t,callback:function(e){}})}),m.on("submit(checkReady)",function(e){l.isReadyNotice({ids:"all",callback:function(e){window.location.reload()}})})}})});