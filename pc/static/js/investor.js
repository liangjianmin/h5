layui.define(["element","form","laypage","util","user","path","utils","bank","popup","laydate","validate"],function(exports){var element=layui.element,form=layui.form,laypage=layui.laypage,util=layui.util,user=layui.user,path=layui.path,utils=layui.utils,bank=layui.bank,popup=layui.popup,laydate=layui.laydate,validate=layui.validate;function userNavInfo(e){$("#userAvatar").attr("src",e.avatar);var t=e.showName,a=e.srbank.is_srbank_user,n=e.bankcard_status,i=e.unReadNotice,s={avatar:e.avatar,show_name:t,is_srbank_user:a,is_bind_card:n,un_read_notice:i};sessionStorage.setItem("userInfoData",JSON.stringify(s)),$("#userNameInfo").text(t),a&&$("#userTelInfo").addClass("link-item01-s"),"UNBIND"!==n&&$("#userCardInfo").addClass("link-item03-s"),i&&$("#msgIcon").show()}function userNavInfoSesstionStorage(){var e=sessionStorage.getItem("userInfoData");e=JSON.parse(e),$("#userAvatar").attr("src",e.avatar),$("#userNameInfo").text(e.show_name),e.is_srbank_user&&$("#userTelInfo").addClass("link-item01-s"),"UNBIND"!==e.is_bind_card&&$("#userCardInfo").addClass("link-item03-s"),e.un_read_notice&&$("#msgIcon").show()}exports("investor",{init:function(){utils.isPage("/investor/user_center.html")&&this.userCenterPage(),utils.isPage("/investor/trade_in.html")&&this.tradeInPage(),utils.isPage("/investor/trade_out.html")&&this.tradeOutPage(),utils.isPage("/investor/trade_out_list.html")&&this.tradeOutListPage(),utils.isPage("/investor/capital_details.html")&&this.captialDetailPage(),utils.isPage("/investor/loan_record.html")&&this.loanRecordPage(),utils.isPage("/investor/reservation.html")&&this.reservationPage(),utils.isPage("/investor/transfer.html")&&this.transferPage(),utils.isPage("/investor/invite_friend.html")&&this.inviteFriendsPage(),utils.isPage("/investor/setting.html")&&this.settingPage(),utils.isPage("/investor/depository_account.html")&&this.depositoryAccountPage(),utils.isPage("/investor/bank_tel_change.html")&&this.bankTelChangePage(),utils.isPage("/investor/bank_card.html")&&this.bankCardPage(),utils.isPage("/investor/unbind_card_step.html")&&this.unbindCardStepPage(),utils.isPage("/investor/user_sign.html")&&this.userSignPage(),utils.isPage("/investor/tel_authentication.html")&&this.telAuthenticationPage(),utils.isPage("/investor/tel_change.html")&&this.telChangePage(),utils.isPage("/investor/pass_change.html")&&this.passChangePage(),utils.isPage("/investor/msg.html")&&this.msgPage(),utils.isPage("/investor/balance_return.html")&&this.balanceReturnPage()},userCenterPage:function(){function u(e){e.addClass("active"),$(".js-money").each(function(e,t){$(this).html("--.--")})}function p(e){e.removeClass("active"),$(".js-money").each(function(e,t){var a=$(this).data("money");$(this).html(a)})}function l(e){return e<10&&(e="0"+e),e}function c(e){user.paybackCalendarNew({month:e,day:"",page:1,pageSize:10,callback:function(e){var t,a,n,i,s;t=e.survey,a=t.month_payment,n=t.month_payment_num,i=t.month_earned_payment,s=t.month_forward_payment,$("#monthPayment").text(a).data("money",a),$("#monthPaymentNum").text(n).data("money",n),$("#monthEarnedPayment").text(i).data("money",i),$("#monthForwardPayment").text(s).data("money",s)}})}user.investUserCenter({callback:function(e){console.log(e),userNavInfo(e.user),function(e,t){var a=e.totalAsset_format,n=e.wait_principal,i=e.block_total_money,s=e.available_total_money,r=e.pending_income,o=e.pending_total_interest,l=e.pending_invest_reward,c=e.pending_invite_reward;$("#totalAssetFormat").text(a).data("money",a),$("#waitPrincipal").text(n).data("money",n),$("#blockTotalMoney").text(i).data("money",i),$("#availableTotalMoney").text(s).data("money",s),$("#pendingIncome").text(r).data("money",r),$("#pendingTotalInterest").text(o).data("money",o),$("#pendingInvestReward").text(l).data("money",l),$("#pendingInviteReward").text(c).data("money",c);var d=t.batch_no;batchAutoHref="/standard/reservation_tender?batch_no="+d,$("#batchAutoHref").attr("href",batchAutoHref),"0"===$.cookie("is_show_money")?u($("#toogleBtn")):p($("#toogleBtn"));$("#waitInvestReward").data("coupon_ids",e.pending_invest_reward_coupon_ids),$("#waitInviteReward").data("coupon_ids",e.pending_invite_reward_coupon_ids)}(e.money_info,e.batch_auto_info),$("#toogleBtn").on("click",function(e){var t;e.preventDefault(),t=$(this),"1"===$.cookie("is_show_money")?($.cookie("is_show_money",0,{expires:10,path:"/"}),u(t)):(p(t),$.cookie("is_show_money",1,{expires:10,path:"/"}))});for(var t=new Date,a=t.getFullYear(),n=t.getMonth()+1,i="",s="",r=a-3;r<=a+3;r++){if(r===a)var o="selected";else o="";i+='<option value="'+r+'" '+o+">"+r+"年</option>"}for(r=1;r<=12;r++){if(r===n)o="selected";else o="";s+='<option value="'+l(r)+'" '+o+">"+r+"月</option>"}$("#selectYear").empty().append(i),$("#selectMonth").empty().append(s),form.render("select"),c(""+a+l(n)+"01"),form.on("select(selectYear)",function(e){c(e.value+$("#selectMonth").val()+"01")}),form.on("select(selectMonth)",function(e){c($("#selectYear").val()+e.value+"01")}),$("#waitInvestReward, #waitInviteReward").on("click",function(e){e.preventDefault(),function(e){if(!e.data("coupon_ids"))layer.msg("已全部返完")}($(this))}),e.user.srbank.is_srbank_user||($("#tradeInBtn, #tradeOutBtn").on("click",function(e){e.preventDefault(),popup.openTips02Layer("INVESTOR")}),$.cookie("is_open_bank_layer")||($.cookie("is_open_bank_layer",1),popup.bankTipLayer("INVESTOR")),$("#userAccountInfo").slideDown().find("p").html('<i class="sr-tip-icon"></i>为了您的资金安全和交易合规，投资前需先开通上饶银行存管账户。<a href="javascript:;" id="quick_open_sr">立即开通</a>'),$("#quick_open_sr").on("click",function(e){e.preventDefault();var t=path.openBankRedirectUrl+path.openBankSuccessUrl;bank.openBank({redirectUrl:t})}))}})},tradeInPage:function(){bank.tradeInPage(function(d){console.log(d);var e=d.user,u=e.srbank,t=u.is_srbank_user,a=u.is_srbank_user_bindcard,n=e.bankcard_status,i=u.need_reset_pwd_first;u.is_srbank_user_sign_auto_bid,u.is_srbank_user_sign_credit_transfer,u.is_srbank_user_sign_transfer;userNavInfo(d.user),bank.validateBank({validata:{signAutoBid:!1},isSrbankUser:t,srbankUserCallback:function(){popup.bankTipLayer("INVESTOR")},isSrbankUserBindcard:a,bankcardStatus:n,bindCardCallback:function(){},isNeedRestPWD:i,resetPWDCallback:function(){},validataSuccessCallback:function(){!function(e){var t=e.user,a=t.srbank.bankcard,n=a.status_order,i=t.available_total_money,s=a.bankName,r=a.bankcardNo_e,o=a.img_logo_url,l=a.bankLimit.split("/");n||($("#bankImg").addClass("bank-icon-no"),$("#bankCardInfo").html("("+s+'暂不支持快捷支付，推荐使用<a class="webbank-btn" id="bankTradePageBtn" href="'+path.investUserTradeIn+'#trade_in=bank">银行转账</a>)'));$("#userAbailableAmont").text(i),$("#bankImg").css({"background-image":"url("+o+")"}),$("#bankName").text(s),$("#bankNo").text(r),$("#bankOneLimit").text(l[0]),$("#bankDateLimit").text(l[1]),$("#bankMonthLimit").text(l[2]);var c=function(e){var t="",a=[];for(var n in e)a.push(e[n]);for(var n=0;n<a.length;n++)0<a[n].order&&(t+='<li class="bank-list" data-code="'+a[n].bankcode+'" data-bankname="'+a[n].name+'"><img src="'+a[n].img_all_url+'" alt=""></li>');return t}(e.payway.WEB.banks);$("#WEB_lists").empty().append(c),$("#bankTransferName").text(s),$("#bankTransferNo").text(r)}(d);var a,n,i,s,r,o,l,e=u.bankcard.bankcode,t=path.openBankRedirectUrl+path.investTradeInResultUrl,c=u.bankcard.status_order;a=e,n=t,i=c,$("#tradeInQuickMoney").on("keyup",function(e){e.preventDefault();var t=$("#tradeInQuickBtn"),a="is-disabled",n=1*$(this).val();100<=n?t.removeClass(a).attr({disabled:!1}):(layer.tips("充值金额不能低于100元","#tradeInQuickMoney"),t.addClass(a).attr({disabled:!0}))}),form.on("submit(tradeInQuick)",function(e){if(!i)return layer.tips("银行维护中，请使用转账充值!","#tradeInQuickBtn"),!1;var t=e.field.trade_in_money;return bank.tradeIn({amount:t,rechargeWay:"SWIFT",bankcode:a,redirectUrl:n,callback:function(e){window.location.href=e}}),!1}),s=t,r=$("#tradeInWebMoney"),o=$("#tradeInWebBtn"),l="is-disabled",$("body").on("click","#WEB_lists li.bank-list",function(e){e.preventDefault(),$(this).addClass("is-select").siblings().removeClass("is-select");var t=1*r.val(),a=$(this).data("code");100<=t&&a?o.removeClass(l).attr({disabled:!1}):o.addClass(l).attr({disabled:!0})}),$("#tradeInWebMoney").on("keyup",function(e){e.preventDefault();var t=1*$(this).val(),a=$("#WEB_lists .bank-list.is-select").data("code");100<=t&&a?o.removeClass(l).attr({disabled:!1}):(t<100&&layer.tips("充值金额不能低于100元","#tradeInWebMoney"),o.addClass(l).attr({disabled:!0}))}),form.on("submit(tradeInWeb)",function(e){var t=e.field.trade_in_web_money,a=$("#WEB_lists .bank-list.is-select").data("code");return bank.tradeIn({amount:t,rechargeWay:"WEB",bankcode:a,redirectUrl:s,callback:function(e){window.location.href=e}}),!1})}}),$("#openBankList").on("click",function(e){e.preventDefault();var t=$("#WEB_lists"),a=$(this);a.data("open")?(t.css({overflow:"hidden"}),a.html('展开<i class="icon"></i>'),a.data("open","")):(t.css({overflow:"inherit"}),a.html('收起<i class="icon open"></i>'),a.data("open",!0))}),$("#bankTransferInfoBtn").on("click",function(e){e.preventDefault(),popup.banktransferInfoLayer()});var s=new Clipboard("#copyGSName");s.on("success",function(e){layer.msg("复制成功！")}),s.on("error",function(e){layer.msg("复制失败，您可以使用手动复制!")});var r=new Clipboard("#copyYHName");r.on("success",function(e){layer.msg("复制成功！")}),r.on("error",function(e){layer.msg("复制失败，您可以使用手动复制!")});var o=new Clipboard("#copyYHNo");o.on("success",function(e){layer.msg("复制成功！")}),o.on("error",function(e){layer.msg("复制失败，您可以使用手动复制!")});var l=location.hash.replace(/^#trade_in=/,"");element.tabChange("tradeInTab",l),element.on("tab(tradeInTab)",function(){location.hash="trade_in="+this.getAttribute("lay-id")}),$("#bankTradePageBtn").on("click",function(e){e.preventDefault(),window.location.href=path.investUserTradeIn+"#trade_in=bank",location.reload()})}),$("#bankLimitBtn").on("click",function(e){e.preventDefault(),popup.bankListLayer()})},tradeOutPage:function(){bank.tradeOutPage(function(m){console.log(m);var _=m.user,e=_.srbank,t=e.is_srbank_user,a=e.is_srbank_user_bindcard,n=_.bankcard_status,i=e.need_reset_pwd_first;e.is_srbank_user_sign_auto_bid,e.is_srbank_user_sign_credit_transfer,e.is_srbank_user_sign_transfer;userNavInfo(m.user),bank.validateBank({validata:{signAutoBid:!1},isSrbankUser:t,srbankUserCallback:function(){popup.bankTipLayer("INVESTOR")},isSrbankUserBindcard:a,bankcardStatus:n,bindCardCallback:function(){},isNeedRestPWD:i,resetPWDCallback:function(){},validataSuccessCallback:function(){var e,t,a,n,i,s,r,o,l,c;e=m.user,t=e.srbank.bankcard,a=e.available_total_money,n=t.bankName,i=t.bankcardNo,s=t.img_logo_url,r=t.realName_e,o=e.withdraw_info,l=i.replace(/^(\d{4})(\d*)(\d{4})$/,"$3"),c=e.usr_note_title,$("#freeRate").text(o.rate),$("#TradeOutFreeNum").text(o.free_times),$("#availableAmount").text(a),$("#bankName").text(n).css({"background-image":"url("+s+")"}),$("#bankNo").text(i),$("#bankUser").text(r),$("#bankCardNo").text(l),c&&($("#tradeOutList").show(),$("#tradeOutListBtn").attr("href",path.tradeOutList));var d,u,p=1*_.available_total_money;d=p,u=_.withdraw_info.rate,$("#tradeOutInput").on("input propertychange",function(e){e.preventDefault();var t=$("#tradeOutBtn"),a=1*$(this).val(),n=(a*u).toFixed(2);return $("#getMoney").text(a-n),$("#freeMoney").text(n),a<100?(layer.tips("提现金额不可低于100元","#tradeOutInput"),t.attr({disabled:!0}).addClass("is-disabled"),!1):d<a?(layer.tips("超出可提现金额！","#tradeOutInput"),t.attr({disabled:!0}).addClass("is-disabled"),!1):void t.attr({disabled:!1}).removeClass("is-disabled")}),$("#tradeOutAllBtn").on("click",function(e){e.preventDefault(),$("#tradeOutInput").val(p);var t=(p*_.withdraw_info.rate).toFixed(2);if($("#getMoney").text(p-t),$("#freeMoney").text(t),p<100)return layer.tips("提现金额不可低于100元","#tradeOutInput"),!1;$("#tradeOutBtn").attr({disabled:!1}).removeClass("is-disabled")});var f,b=path.openBankRedirectUrl+path.tradeOutSuccessUrl+"user_type=investor";f=b,form.on("submit(tradeOutForm)",function(e){var t=e.field.trade_out_money;return bank.tradeOut({amount:t,redirectUrl:f,callback:function(e){console.log(e),window.location.href=e}}),!1})}})})},tradeOutListPage:function(){user.withdrawList({callback:function(e){console.log(e),userNavInfo(e.user),function(e){if(0<e.length){for(var t="",a=0;a<e.length;a++){var n=e[a].left_time;t+="<tr><td>"+e[a].time+"</td><td>"+e[a].money+"</td><td>"+e[a].fee+"</td><td>"+e[a].status+'(<span id="leftTime">'+n+"</span>)</td></tr>"}$("#tradeOutListTable").empty().append(t),0<n&&utils.cuntDown("#leftTime",n,function(e,t){layui.$("#leftTime").html(t[2]+"分"+t[3]+"秒")})}}(e.list)}})},captialDetailPage:function(){function i(e){var t="",a=e.count.num,n=e.list,i="";if(0<a)for(var s=0;s<n.length;s++)"冻结"===n[s].bill_type?i='<td class="bill-black">'+n[s].money+"</td>":"支出"===n[s].bill_type?i='<td class="bill-red">-'+n[s].money+"</td>":"收入"===n[s].bill_type&&(i='<td class="bill-green">+'+n[s].money+"</td>"),t+="<tr><td>"+n[s].time+"</td><td>"+n[s].bill_type+"</td><td>"+n[s].trade_type+"</td>"+i+"<td>"+n[s].new_balance+"元</td><td>"+n[s].remark_user+"</td></tr>";else t+='<tr class="empty"><td colspan="6">空空如也...</td></tr>';$("#capitalTable").empty().append(t)}function s(e){console.log(e),1<e.count.page_count?laypage.render({elem:"capitalPage",count:e.count.num,limit:10,theme:"#f60",layout:["prev","page","next","skip"],jump:function(e,t){if(!t){var a=$(".js-invest-time.is-select").data("type"),n=$(".js-invest-type.is-select").data("type");a||(a=0),user.investFundList({page:e.curr,pageSize:10,timeType:a,startTime:0,endTime:0,detailType:n,callback:function(e){i(e.list)}})}}}):$("#capitalPage").hide()}laydate.render({elem:"#dateStart"}),laydate.render({elem:"#dateEnd"}),user.investFundList({page:1,pageSize:10,timeType:0,startTime:0,endTime:0,detailType:"invest",callback:function(e){console.log(e),userNavInfo(e.user),i(e.list),s(e.list)}}),$(".js-invest-time").on("click",function(){console.log(),$(this).addClass("is-select").siblings().removeClass("is-select");var e=$(this).data("time"),t=$(".js-invest-type.is-select").data("type");console.log(t),user.investFundList({page:1,pageSize:10,timeType:e,startTime:0,endTime:0,detailType:t,callback:function(e){i(e.list),s(e.list)}})}),$(".js-invest-type").on("click",function(){$(this).addClass("is-select").siblings().removeClass("is-select");var e=$(this).data("type"),t=$(".js-invest-time.is-select").data("time");t||(t=0),user.investFundList({page:1,pageSize:10,timeType:t,startTime:0,endTime:0,detailType:e,callback:function(e){i(e.list),s(e.list)}})}),$("#timeSearchBtn").on("click",function(e){e.preventDefault();var t=$("#dateStart").val(),a=$("#dateEnd").val(),n=$(".js-invest-type.is-select").data("type");t||a?($(".js-invest-time").removeClass("is-select"),user.investFundList({page:1,pageSize:10,timeType:0,startTime:t,endTime:a,detailType:n,callback:function(e){i(e.list),s(e.list)}})):layer.tips("请选择起始时间和结束时间!","#timeSearchBtn")})},loanRecordPage:function(){var e=1,t=10,a="STANDARD,TRANSFER",n="1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36",i="FUNDRAISING,PAYBACK,FINISH,ADVAN_FINISH,FAILURE";function r(e){var r="";0<e.length?$.each(e,function(e,t){var a="";a=0!==t.history_interest?'<td><a href="javascript:;" class="link pay-btn back_money_js" data-payback_principal_interest="'+t.payback_principal_interest+'" data-investment_id="'+t.investment_id+'">还款计划</a><br /><a href="javascript:;" data-url="'+t.contract_url+'" class="link protocol protocol-btn" style="color: #141414;">合同协议</a></td>':"<td></td>";var n="";n=0<t.is_novice?'<i class="icon" style="display: inline-block; width: 60px;height: 24px;background-color: #f45e5e;border-radius: 3px;text-align: center;line-height: 24px;font-size: 12px;color: #fff;margin-right: 5px;">新手专享</i>':"";var i="",s="";0<t.left_investment_month&&(i=t.left_investment_month+"个月"),0<t.left_investment_day&&(s=t.left_investment_day+"天"),r+='<tr><td style="text-align: left;width:230px;"><a target="_bank" href="'+t.forward_url+'" style="color: #141414;font-size: 13px;">'+n+t.loan_text+"</a></td><td>"+i+s+"</td><td>"+t.principal+"</td><td>"+t.interest_rate+"%</td><td>"+t.history_interest+"</td><td>"+t.payback_principal_interest+"</td><td>"+t.due_date+"</td>"+a,"true"==t.can_transfer||1==t.can_transfer?r+='<td class="zr"><a href="'+path.investTransfer+'" class="transfer-btn can_buy_js" >'+t.can_transfer_text+"</a></td>":r+='<td style="color: #757575;">'+t.can_transfer_text+"</td>",r+="</tr>"}):r+='<tr class="empty"><td colspan="9">空空如也...</td></tr>',$("#loanTable").empty().append(r)}function o(e,t,a){var n="",i="",s="",r={};switch(e){case 0:n="STANDARD,TRANSFER";break;case 1:n="STANDARD";break;case 2:n="TRANSFER"}switch(t){case 0:i="FUNDRAISING,PAYBACK,FINISH,ADVAN_FINISH,FAILURE";break;case 1:i="FUNDRAISING";break;case 2:i="PAYBACK";break;case 3:i="FINISH";break;case 4:i="FAILURE";break;case 5:i="ADVAN_FINISH"}switch(a){case 0:s="1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36";break;case 1:s="1,2,3";break;case 2:s="3,4,5,6";break;case 3:s="6,7,8,9,10,11,12";break;case 4:s="12,13,14,15,16,17,18,19,20,21,22,23,24";break;case 5:s="24,25,26,27,28,29,30,31,32,33,34,35,36"}return r.filter_from=n,r.filter_status=i,r.filter_period=s,r}user.investInvestmentList({page:e,pageSize:t,filterFrom:a,filterPeriod:n,filterStatus:i,callback:function(e){var t;console.log(e),userNavInfo(e.user),r(e.list),1<(t=e).maxPage?($("#loanPage").show(),laypage.render({elem:"loanPage",count:t.total,limit:t.limit,theme:"#f60",layout:["prev","page","next","skip"],jump:function(e,t){if(!t){var a=$("#pro_type").find("dd.select").data("protype"),n=$("#pro_status").find("dd.select").data("prostatus"),i=$("#pro_date").find("dd.select").data("prodate"),s=o(a,n,i);user.investInvestmentList({page:e.curr,pageSize:10,filterFrom:s.filter_from,filterPeriod:s.filter_period,filterStatus:s.filter_status,callback:function(e){r(e.list)}})}}})):$("#loanPage").hide()}}),$("#pro_type, #pro_status, #pro_date").find("dd").on("click",function(){!function(e){e.addClass("select").siblings().removeClass("select");var t=$("#pro_type").find("dd.select").data("protype"),a=$("#pro_status").find("dd.select").data("prostatus"),n=$("#pro_date").find("dd.select").data("prodate"),i=o(t,a,n);user.investInvestmentList({page:1,pageSize:10,filterFrom:i.filter_from,filterPeriod:i.filter_period,filterStatus:i.filter_status,callback:function(e){r(e.list)}})}($(this))}),$("body").on("click",".protocol",function(){var e=$(this).data("url");popup.protocolLayer("借款协议",e)}),$("body").on("click",".back_money_js",function(e){e.preventDefault();$(this);var t=$(this).data("investment_id");user.investInvestmentSchedules({investmentID:t,callback:function(e){var t,a,n='<div class="pay-back-wrapper"><div class="pay-back-info"><span>已回本息:'+e.has_principal_interest_total+"元</span><span>待回本息:"+e.wait_principal_interest_total+'元</span></div><div class="pay-back-tip">注：投资管理费按投资收益的10%收取(2018.05.01~2018.12.31期间投资可享受投资管理费五折优惠)</div><table class="layui-table"><thead><tr><th>期次</th><th>还款日期</th><th>还款本息</th><th>还款本金</th><th>还款利息</th><th>投资管理费（优惠前）</th><th>还款状态</th></tr></thead><tbody id="capitalTable">'+(t=e.list,a="",$.each(t,function(e,t){a+="<tr><td>"+t.sequence+"</td><td>"+t.payment_date_format+"</td><td>"+t.principal_interest+"</td><td>"+t.principal+"</td><td>"+t.interest+"</td><td>"+t.fee+"</td><td>"+t.payment_status_format}),a)+"</tbody></table></div>";layer.open({type:1,content:n,skin:"dl__layer back-plan-layer",title:"还款计划",area:["604px","478px"],shade:[.4,"#000"],move:!1,resize:!1})}})})},reservationPage:function(){function i(e,t,a,n){user.reservationList({type:e,page:t,pageSize:a,callback:function(e){n(e)}})}var t=10,a=10;function n(e,t,a,n){1<e.maxPage?laypage.render({elem:t,count:e.total,limit:e.limit,groups:10,layout:["prev","page","next","skip"],theme:"#f60",jump:function(e,t){t||i(a,e.curr,n,function(e){s(a,e.list)})}}):$("#"+t).hide()}function s(e,t){if(1===e){var a="",n="";if(0<t.length)for(var i=0;i<t.length;i++){var s="";s=0<t[i].is_novice?'<i class="icon" style="display: inline-block; width: 60px;height: 24px;background-color: #f45e5e;border-radius: 3px;text-align: center;line-height: 24px;font-size: 12px;color: #fff;margin-right: 5px;">新手专享</i>':"",n=1===t[i].is_can_cancel?'<button class="btn__operation" id="cancel_btn" data-batch_auto_id="'+t[i].id+'">取消</button>':'<span class="btn__operation--disabled" >不可取消</span>',a+="<tr><td>"+s+t[i].time_desc+"</td><td>"+t[i].period_desc+"个月</td><td>"+t[i].rate_desc+"%</td><td>"+t[i].total_money+"</td><td>"+n+"</td></tr>"}else a+='<tr class="empty"><td colspan="5">空空如也...</td></tr>';$("#waitingTable").empty().append(a)}else if(2===e){a="";if(0<t.length)for(i=0;i<t.length;i++){s="";a+="<tr><td>"+(s=0<t[i].is_novice?'<i class="icon" style="display: inline-block; width: 60px;height: 24px;background-color: #f45e5e;border-radius: 3px;text-align: center;line-height: 24px;font-size: 12px;color: #fff;margin-right: 5px;">新手专享</i>':"")+t[i].time_desc+"</td><td>"+t[i].period_desc+"个月</td><td>"+t[i].rate_desc+"%</td><td>"+t[i].total_money+"</td><td>"+t[i].use_money+"</td><td>"+t[i].transfer_interest+"</td><td>"+t[i].end_time_desc+"</td></tr>"}else a+='<tr class="empty"><td colspan="7">空空如也...</td></tr>';$("#doneTable").empty().append(a)}else if(3===e){a="";if(0<t.length)for(i=0;i<t.length;i++)a+="<tr><td>"+t[i].time_desc+"</td><td>"+t[i].period_desc+"个月</td><td>"+t[i].rate_desc+"%</td><td>"+t[i].total_money+"</td><td>"+t[i].end_time_desc+"</td><td>"+t[i].desc+"</td></tr>";else a+='<tr class="empty" ><td colspan="6">空空如也...</td></tr>';$("#cancelTable").empty().append(a)}}i(1,1,10,function(e){console.log(e),userNavInfo(e.user),s(1,e.list),n(e,"cancelPage",1,a),0<e.wait_num&&$("#waitingNum").text("("+e.wait_num+")")}),element.on("tab(reservationTab)",function(){var e=1*this.getAttribute("lay-id");1===e?(console.log(e),i(1,1,10,function(e){s(1,e.list),n(e,"watingPage",1,t)})):2===e?i(2,1,10,function(e){s(2,e.list),n(e,"donePage",2,t)}):3===e&&i(3,1,10,function(e){s(3,e.list),n(e,"cancelPage",3,a)})}),$("body").on("click","#cancel_btn",function(e){e.preventDefault();var t=$(this);layer.confirm("取消预约后系统会对该笔预约金额进行资金解冻，该笔预约金额将不参与投资",{title:"确认取消预约？",btn:["确认取消","暂不取消"],move:!1,resize:!1},function(){user.reservationCancel({batchAutoId:t.data("batch_auto_id"),callback:function(e){layer.msg("取消成功！",{time:500},function(){window.location.reload()})}})},function(){layer.closeAll()})})},transferPage:function(){function i(e,t,a,n){user.investTransferList({filterStatus:e,page:t,pageSize:a,callback:function(e){n(e)}})}var t="QUEUE";function a(e,t,a,n){1<e.maxPage?laypage.render({elem:t,count:e.total,limit:e.limit,groups:10,layout:["prev","page","next","skip"],theme:"#ff6600",jump:function(e,t){t||i(a,e.curr,n,function(e){s(a,e.list)})}}):$("#"+t).hide()}function s(e,t){if("QUEUE"===e){var n="";0<t.length?$.each(t,function(e,t){var a="";a=0<t.is_novice?'<i class="icon" style="display: inline-block; width: 60px;height: 24px;background-color: #f45e5e;border-radius: 3px;text-align: center;line-height: 24px;font-size: 12px;color: #fff;margin-right: 5px;">新手专享</i>':"",n+='<tr><td style="text-align: left;width:230px;"><a href="/standard/detail/'+t.loan_id+'" style="color: #141414;font-size: 13px;">'+a+t.loan_text+"</a></td><td>"+t.loan_period+"个月</td><td>"+t.amount+"</td><td>"+t.interest_rate+"%</td><td>"+t.history_interest+"</td><td>"+t.now_payback+"</td><td>"+t.transfer_money+"</td><td>"+t.create_time_text+"</td>",n+="</tr>"}):n+='<tr class="empty"><td colspan="8">空空如也...</td></tr>',$("#doingTable").empty().append(n)}else if("NO"===e){n="";0<t.length?$.each(t,function(e,t){console.log(t);var a="";a=0<t.is_novice?'<i class="icon" style="display: inline-block; width: 60px;height: 24px;background-color: #f45e5e;border-radius: 3px;text-align: center;line-height: 24px;font-size: 12px;color: #fff;margin-right: 5px;">新手专享</i>':"",n+='<tr><td style="text-align: left;width:230px;"><a href="/standard/detail/'+t.loan_id+'" style="color: #141414;font-size: 13px;">'+a+t.loan_text+"</a></td><td>"+t.loan_period+'个月</td><td class="inveset_money_js">'+t.amount+"</td><td>"+t.interest_rate+"%</td><td>"+t.history_interest+"</td><td>"+t.now_payback+"</td><td>"+t.left_payback+"</td><td>"+t.due_date_text+"</td>",0==t.transfer_status?n+='<td class="zr"><a href="javascript:;" class="transfer-btn transferStandard-js" data-principal="'+t.principal+'" data-manage_fee="'+t.manage_fee+'" data-money_interval="'+t.money_interval+'" data-investment_id="'+t.investment_id+'">'+t.transfer_status_text+"</a></td>":n+='<td style="color: #757575;"><a href="javascript:;">'+t.transfer_status_text+"</a></td>",n+="</tr>"}):n+='<tr class="empty"><td colspan="9">空空如也...</td></tr>',$("#todoTable").empty().append(n)}else if("FINISH"===e){n="";0<t.length?$.each(t,function(e,t){var a="";a=0<t.is_novice?'<i class="icon" style="display: inline-block; width: 60px;height: 24px;background-color: #f45e5e;border-radius: 3px;text-align: center;line-height: 24px;font-size: 12px;color: #fff;margin-right: 5px;">新手专享</i>':"",n+='<tr><td style="text-align: left;width:230px;"><a href="/standard/detail/'+t.loan_id+'" style="color: #141414;font-size: 13px;">'+a+t.loan_text+"</a></td><td>"+t.loan_period+"个月</td><td>"+t.amount+"</td><td>"+t.interest_rate+"%</td><td>"+t.now_payback+"</td><td>"+t.transfer_money+"</td><td>"+t.create_time_text+"</td><td>"+t.transfer_time_text+"</td>",n+="</tr>"}):n+='<tr class="empty" ><td colspan="8">空空如也...</td></tr>',$("#doneTable").empty().append(n)}}function l(e){var t=$("#user_checked").data("checked"),a=e.money_interval.split("-");a[0],a[1];1===t?e.userIDNo?user.investInvestmentTransfer({investmentId:e.investment_id,money:e.money,reason:e.reason,identification:e.userIDNo,callback:function(e){layer.open({title:"提示",content:"转让申请成功!",yes:function(e){layer.closeAll(),window.location.reload()}})}}):layer.msg("请输入身份证末四位！"):layer.msg("请同意协议！")}i(t,1,10,function(e){console.log(e),$("#isBalanceStatus").val(e.user.balance_auto_status),userNavInfo(e.user),s(t,e.list),a(e,"doingPage",1,10)}),element.on("tab(transferTab)",function(){var t=this.getAttribute("lay-id");console.log(t),"QUEUE"===t?(console.log(t),i(t,1,10,function(e){s(t,e.list),a(e,"doingPage",t,10)})):"NO"===t?i(t,1,10,function(e){s(t,e.list),a(e,"todoPage",t,10)}):"FINISH"===t&&i(t,1,10,function(e){s(t,e.list),a(e,"donePage",t,10)})}),$("body").on("click",".transferStandard-js",function(e){e.preventDefault();var s,n=$(this);if(1*$("#isBalanceStatus").val())$("#isOpenBalance").show(),popup.closeBalanceTipLayer({yes:function(e,t){window.location.href=path.balanceReturnUrl},btn2:function(e,t){var s,r=n.data("principal"),a=n.data("manage_fee"),o=n.data("money_interval");$("#transfer_money_layer").text(r+"元"),$("#manage_fee_layer").text(a),$("#money_interval_layer").attr({placeholder:"请输入"+o+"之间的金额"}),s=n,layer.open({type:1,content:$("#transfer_standard_layer"),skin:"transfer-standard",title:"转让确认",area:["604px","510px"],resize:!1,success:function(e,t){$("#sure_btn").off("click").on("click",function(e){e.preventDefault();var t=s.data("investment_id"),a=($("#money_interval_layer").val(),$("#pass").val(),$("#user_id_no").val()),n=$("#select_reason").val(),i={money_interval:o,investment_id:t,money:r,reason:n,userIDNo:a};l(i)}),$("#cancel_btn").off("click").on("click",function(){layer.close(t),window.location.reload()})},cancel:function(){window.location.reload()}})}});else{var r=n.data("principal"),t=n.data("manage_fee"),o=n.data("money_interval");$("#transfer_money_layer").text(r+"元"),$("#manage_fee_layer").text(t),$("#money_interval_layer").attr({placeholder:"请输入"+o+"之间的金额"}),s=n,layer.open({type:1,content:$("#transfer_standard_layer"),skin:"transfer-standard",title:"转让确认",area:["604px","510px"],resize:!1,success:function(e,t){$("#sure_btn").off("click").on("click",function(e){e.preventDefault();var t=s.data("investment_id"),a=($("#money_interval_layer").val(),$("#pass").val(),$("#user_id_no").val()),n=$("#select_reason").val(),i={money_interval:o,investment_id:t,money:r,reason:n,userIDNo:a};l(i)}),$("#cancel_btn").off("click").on("click",function(){layer.close(t),window.location.reload()})},cancel:function(){window.location.reload()}})}}),$("body").on("click","#user_checked",function(){1===$(this).data("checked")?($(this).removeClass("checked"),$(this).data("checked",0)):($(this).data("checked",1),$(this).addClass("checked"))})},inviteFriendsPage:function(){function showDOM(e){var t=e.pc_url,a=e.pc_img_url,n=e.total_num,i=e.hasCashBackTotal_format,s=e.waitCashBackTotal_format,r=e.pc_invite_url;$("#inviteLink").attr("href",t),$("#inviteImg").attr("src",a),$("#inviteNum").text(n),$("#hasCashBackTotal").text(i),$("#waitCashBackTotal").text(s),$("#inviteShareLink").val(r);var o=e.invest_list,l="";if(o)for(var c=0;c<o.length;c++)l+="<tr><td>"+o[c].mobile+"</td><td>"+o[c].real_name+"</td><td>"+o[c].register_time+"</td><td>"+o[c].invest_time+"</td><td>"+o[c].remark+"</td></tr>";else l='<tr class="empty"><td colspan="5">空空如也...</td></tr>';$("#inviteInvestTable").empty().append(l)}function showInviteList(e){var t="";if(0<e.length)for(var a=0;a<e.length;a++)t+="<tr><td>"+e[a].mobile+"</td><td>"+e[a].real_name+"</td><td>"+e[a].register_time+"</td><td>"+e[a].first_invest_time+"</td><td>"+e[a].remark+"</td></tr>";else t='<tr class="empty"><td colspan="5">空空如也...</td></tr>';$("#inviteAllTable").empty().append(t)}function showInvitePage(a){console.log(a),1<a.pageTotal&&laypage.render({elem:"inviteAllPage",count:a.total,limit:1*a.pageSize,groups:10,layout:["prev","page","next","skip"],theme:"#ff6600",jump:function(e,t){t||user.inviteList({page:e.curr,pageSize:1*a.pageSize,callback:function(e){showInviteList(e.data)}})}})}user.inviteData({callback:function(data){console.log(data),userNavInfo(data.user),showDOM(data);var button_type="";function SetShareUrl(e,t){return t.bdUrl=data.pc_invite_url,t}with($(".js-share-btn").mouseover(function(){button_type=$(this).data("cmd")}),window._bd_share_config={common:{bdText:"多啦聚财-安全、透明的互联网金融理财平台",bdDesc:"我在多啦聚财投资，邀请你一起加入，让财富稳健增长，注册有惊喜哦！",bdMini:1,bdMiniList:!1,bdStyle:1,bdSize:32,onBeforeClick:SetShareUrl,bdPic:path.shareLogoImg},share:[{tag:"share_platform",bdSize:16},{bdSize:32}]},document)(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src=path.shareJs+"?cdnversion="+~(-new Date/36e5);$("#msgShareBtn").on("click",function(e){e.preventDefault(),layer.open({content:$("#msgShareWrapper").html(),skin:"dl__layer share-msg-layer",btn:!1,move:!1,resize:!1,area:["600px","258px"],success:function(){form.on("submit(sendMsgForm)",function(e){return console.log(e),!1})}})});var copyPath01=new Clipboard("#copyInviteShareLink");copyPath01.on("success",function(e){layer.open({content:"链接复制成功，发送给好友！"})}),copyPath01.on("error",function(e){layer.msg("复制失败，您可以使用手动复制!")})}}),user.inviteList({page:1,pageSize:10,callback:function(e){showInviteList(e.data),showInvitePage(e)}})},settingPage:function(){function n(e){var t="";t+='<div class="risk-content"><form class="layui-form"><ol class="risk-question-lists" id="riskQuestionLists">';for(var a=0;a<e.length;a++){if(0===a)var n='<li class="risk-question-item active" style="display: block">';else n='<li class="risk-question-item active">';t+=n+'<h3 class="risk-question-tit">'+e[a].title+"</h3>";var i=e[a].content;for(var s in i)t+='<div class="risk-row"><input type="radio" name="'+a+'" value="'+s+'" title="'+i[s]+'" lay-filter="risk_radio"></div>';t+="</li>"}return t+='</ol><div class="btn-wrapper clearfix"><button class="risk-btn risk-btn--disabled fl" id="riskPrevBtn" disabled>上一题</button><button class="risk-btn fr" id="riskNextBtn">下一题</button><button class="risk-btn risk-btn--disabled fr" id="riskSubmitBtn" style="display: none;" disabled lay-submit lay-filter="risk_form">提交</button></div></form></div>'}function f(e){var t="",a="",n="";switch(e){case"保守型":t="风险承受能力极低，对收益要求不高，追求资本金绝对安全。预期报酬率优于中长期存款利率（约3-5年），并确保本金在通货膨胀中发挥保值功能。",a="100万",n="五星";break;case"稳健型":t="风险承受度适中，偏向于资产均衡配置，能够承受一定的投资风险，同时，对资产收益要求高于保守型投资者。",a="400万",n="五星和四星半、四星";break;case"成长型":t="风险承受能力较高，投资收益预期相对较高，资产配置以高风险品种为主，资产市值波动较大，除获取资本利得之外，也寻求投资差价收益。",a="1500万",n="五星、四星半和四星、三星半";break;case"激进型":t="对风险有非常高的承受能力，资产配置以高风险投资品种为主，投机性强，利用市场波动赢取差价，追求在较短周期内的收益最大化。",a="4000万",n="五星、四星半、四星、三星半、三星"}return{riskDesc:t,riskMoney:a,riskStar:n}}user.setting({callback:function(e){console.log(e);var t=e.user,a=t.srbank.is_srbank_user;userNavInfo(e.user),function(e){console.log(e);var t=e.srbank,a=t.is_srbank_user,n=t.is_srbank_user_sign_auto_bid,i=t.is_srbank_user_sign_credit_transfer,s=t.is_srbank_user_sign_transfer,r=e.bankcard_status;e.whether_evaluation&&($("#riskType, #riskType02").text(e.evaluation_type),$("#riskBtn").text("重新测评"),$("#userRisk").addClass("icon-risk-s"),$("#riskDesc").html(function(e){var t="";switch(e){case"保守型":t="风险承受能力极低，对收益要求不高，追求资本金绝对安全。预期报酬率优于中长期存款利率（约3-5年），并确保本金在通货膨胀中发挥保值功能。<br />您的个人出借金额上限：100万。<br />适合投资项目安全等级：五星。<br />注：以上建议仅供参考，不构成任何收益保证。";break;case"稳健型":t="风险承受度适中，偏向于资产均衡配置，能够承受一定的投资风险，同时，对资产收益要求高于保守型投资者。<br />您的个人出借金额上限：400万。<br />适合投资项目安全等级：五星和四星半、四星。<br />注：以上建议仅供参考，不构成任何收益保证。";break;case"成长型":t="风险承受能力较高，投资收益预期相对较高，资产配置以高风险品种为主，资产市值波动较大，除获取资本利得之外，也寻求投资差价收益。<br />您的个人出借金额上限：1500万。<br />适合投资项目安全等级：五星、四星半和四星、三星半。<br />注：以上建议仅供参考，不构成任何收益保证。";break;case"激进型":t="对风险有非常高的承受能力，资产配置以高风险投资品种为主，投机性强，利用市场波动赢取差价，追求在较短周期内的收益最大化。<br />您的个人出借金额上限：4000万。<br />适合投资项目安全等级：五星、四星半、四星、三星半、三星。<br />注：以上建议仅供参考，不构成任何收益保证。"}return t}(e.evaluation_type)));if(a){var o=t.card_no_e,l=t.mobile_e,c=t.name_e,d=t.cert_no_e;if($("#bankIcon").addClass("icon-bank-s"),$("#bankCardNo").text(o),$("#bankBtn").text("查看").attr({href:path.investUserBank}),n&&i&&s&&$("#bankSignIcon").addClass("icon-sign-s"),"UNBIND"!==r){var u=t.bankcard.bankcardNo.replace(/^(\d{4})(\d*)(\d{4})$/,"$3");$("#cardIcon").addClass("icon-card-s"),$("#bankCard").text("尾号"+u+" | "+c+" | "+d),$("#bankCardBtn").text("查看").attr({href:path.investUserBankCard})}$("#userTel").text(l),$("#userPass02").addClass("icon-pass02-s")}else $("#bankBtn").on("click",function(e){e.preventDefault();var t=path.openBankRedirectUrl+path.openBankSuccessUrl;bank.openBank({redirectUrl:t,userRole:"INVESTOR"})}),$("#bankCardBtn, #checkSignBtn").on("click",function(e){e.preventDefault(),popup.openTips02Layer("INVESTOR")})}(t),$("#resetPassBtn").on("click",function(e){e.preventDefault();var t=path.debtorUserCenterUrl;a?bank.resetPass({redirectUrl:t,authCode:"",needCheck:!1,callback:function(e){window.location.href=e}}):popup.openTips02Layer("INVESTOR")}),$("#riskBtn").on("click",function(e){e.preventDefault(),function p(){user.riskEvaluationQuestion({callback:function(e){console.log(e),riskHtml=n(e);var u=layer.open({type:1,content:riskHtml,area:"630px",resize:!1,move:!1,title:"风险测评",fixed:!1,skin:"dl__layer risk-layer",success:function(){form.render();var a=0,n=$("#riskQuestionLists").children(),i=n.length,s="risk-btn--disabled",r=$("#riskPrevBtn"),o=$("#riskNextBtn"),l=$("#riskSubmitBtn");function t(e){--a<i&&(l.hide(),o.show()),d(e,s,a),n.eq(a).show().addClass("active").siblings().removeClass("active").hide()}function c(e){var t=$("#riskQuestionLists li.active input:radio:checked").val();t?(d(r,s,++a),a===i-1&&(e.hide(),l.show()),n.eq(a).show().addClass("active").siblings().removeClass("active").hide()):layer.tips("请选择与您情况相符合的选项！","#riskNextBtn")}function d(e,t,a){a?e.removeClass(s).attr("disabled",!1):e.addClass(s).attr("disabled",!0)}o.on("click",function(e){e.preventDefault(),c($(this))}),r.on("click",function(e){e.preventDefault(),t($(this))}),form.on("radio(risk_radio)",function(e){var t=$("#riskQuestionLists li.active input:radio:checked").val();a!==i-1?setTimeout(function(){c(o)},300):t&&l.removeClass(s).attr("disabled",!1)}),form.on("submit(risk_form)",function(e){var t=e.field,a=[];for(var n in t)a.push(Number(t[n]));return user.riskEvaluation({answer:JSON.stringify(a),callback:function(e){layer.close(u);var t='<div class="risk-result"><div class="result-icon"><i class="result-icon-text">恭喜您完成评测！</i></div><div class="result-text">您的风险评测为：'+e.type_data+'</div><div class="result-desc">'+f(e.type_data).riskDesc+'</div><ul class="result-info-lists"><li class="result-info-item clearfix"><span class="result-info-tit">您的个人出借金额上限</span><span class="result-info-text">'+e.amount+'万</span></li><li class="result-info-item clearfix"><span class="result-info-tit">适合投资项目安全等级</span><span class="result-info-text">'+e.star_desc+'</span></li></ul><div class="result-tip">注：以上建议仅供参考，不构成任何收益保证。</div><div class="result-btn-wrapper"><button class="result-btn result-btn--sure" id="confirmBtn">确认</button><button class="result-btn result-btn--reset" id="resetBtn">重新评测</button></div></div>';layer.open({type:1,content:t,area:"630px",resize:!1,move:!1,title:"风险评测",skin:"dl__layer risk-result-layer",fixed:!1,success:function(e,t){$("#confirmBtn").on("click",function(e){e.preventDefault(),layer.close(t),window.location.reload()}),$("#resetBtn").on("click",function(e){e.preventDefault(),layer.close(t),form.render(),p()})}})}}),!1})}})}})}()})}})},depositoryAccountPage:function(){bank.getBankInformation({callback:function(e){console.log(e),userNavInfo(e.user);var t=e.user.is_organization,a=e.user.srbank,n=a.card_no_e,i=a.name_e,s=a.cert_no_e,r=a.mobile_e,o=a.customer_no?a.customer_no:"",l=$("#no_organization"),c=$("#organization");n=n.replace(/(.{4})/g,"$1 "),o=o.replace(/^(\d{4})(\d*)(\d{4})$/g,"$1****$3"),$("#bankCardNo").text(n),$(".js-bank-name").text(i),$(".js-bank-id").text(s),$(".js-bank-tel").text(r),$("#bank_custom_no").text(o),t?(c.show(),l.remove()):(l.show(),c.remove())}})},bankTelChangePage:function(){userNavInfoSesstionStorage(),$("#getCode").on("click",function(e){$(this);var t=$("#userTel").val();return t?validate.isTel(t)?(utils.cuntDown("#getCode",60),e.preventDefault(),void bank.sendPhoneYzm({phoneNum:1*t,type:"update_mobile",checkMobile:0,callback:function(e){layer.msg("发送成功！")}})):($("#formTip").show().text("手机号输入错误"),!1):($("#formTip").show().text("请输入手机号"),!1)}),form.on("submit()",function(e){console.log(e);var t=e.field;return bank.modifyReservedMobile({mobile:t.user_tel,authCode:t.user_code,callback:function(e){layer.open({content:"预留手机号修改成功!",yes:function(){window.location.href=path.investUserBank},cancle:function(){window.location.reload()}})}}),!1})},bankCardPage:function(){bank.getBankInformation({callback:function(e){console.log(e),userNavInfoSesstionStorage();var t=e.user.srbank,a=e.user.bankcard_status,n=t.bankcard.bankcardNo_e,i=t.bankcard.mobile_e,s=$("#bindCard"),r=$("#unbindingCard"),o=$("#unbindCard");"BIND"===a?($(".js-card-no").text(n),$(".js-card-tel").text(i),s.show()):"UNBINDING"===a?($(".js-card-no").text(n),r.show()):o.show()}}),$("#saveCard").on("click",function(e){e.preventDefault(),popup.saveCardLayer()})},unbindCardStepPage:function(){bank.unbindBankcardPage({callback:function(e){console.log(e),userNavInfoSesstionStorage();var n=e.user;$("#userCardName").text(n.realName),$("#userName").val(n.realName),$("#userID").val(n.idCardNo.replace(/^(\d{4})(\d*)(\d{4})$/,"$1****$3")),$("#userTel").val(n.mobile),$("#getCode").on("click",function(e){$(this);var t=(new Date).getTime(),a=t+59e3;util.countdown(a,t,function(e,t,a){var n=e[3]<10?"0"+e[3]:e[3];n<=0?layui.$("#getCode").val("获取验证码").attr("disabled",!1).removeClass("is-disabled"):layui.$("#getCode").val(n+"s后重新获取").attr("disabled",!0).addClass("is-disabled")}),e.preventDefault(),bank.sendPhoneYzm({phoneNum:1*n.mobile,type:"update_mobile",checkMobile:0,callback:function(e){layer.msg("发送成功！")}})}),form.on("submit(unbindForm01)",function(e){var t=e.field;return bank.unbindBankcardCheck({verifyCode:t.user_code,bankcardno:t.user_card_no,mobile:t.user_tel,callback:function(e){$("#inputForm").remove(),$("#uploadIDForm").show()}}),!1}),$("#uploadImgBtn").on("click",function(e){e.preventDefault(),$("#upload_img").attr("src")||layer.tips("请添加照片","#uploadImgBtn")}),$(".upload_images").on("change",function(){lrz(this.files[0],{width:400},function(e){var t=e.base64,a=e.origin.name,n=t.split(",")[1],i=a.split("."),s=i[i.length-1];$("#upload_img").show().attr("src",t),$(".change-upload01").hide(),$(".change-upload02").show().css({"z-index":1e4}),$("#uploadImgBtn").off("click").on("click",function(e){e.preventDefault(),bank.unbindBankcardApply({imgbase64:n,type:s,callback:function(e){$("#upload_img").attr("src",e.img_path);var t=path.debtorUserBankCard;popup.uploadImgLayer(t)}})})})})}})},userSignPage:function(){function r(e){var t=path.investUserCenterUrl;bank.sign({signType:e,redirectUrl:t,callback:function(e){window.location.href=e}})}user.setting({callback:function(e){console.log(e),userNavInfoSesstionStorage();var t=e.user.srbank,a=t.is_srbank_user_sign_auto_bid,n=t.is_srbank_user_sign_credit_transfer,i=t.is_srbank_user_sign_transfer,s=e.user.is_sign_invest_agreement;a?($("#signSutoBid").remove(),$("#isSignSutoBid").show()):($("#signSutoBid").show(),$("#isSignSutoBid").remove(),$("#signSutoBid").on("click",function(e){e.preventDefault(),r("sign_auto_bid")})),n?($("#signCreditTransfer").remove(),$("#isSignCreditTransfer").show()):($("#signCreditTransfer").show(),$("#isSignCreditTransfer").remove(),$("#signCreditTransfer").on("click",function(e){e.preventDefault(),r("sign_credit_transfer")})),i?($("#signTransfere").remove(),$("#isSignTransfere").show()):($("#signTransfere").show(),$("#isSignTransfere").remove(),$("#signTransfere").on("click",function(e){e.preventDefault(),r("sign_transfer")})),s&&$("#isInvestProtocol").show(),$("#investProtocolBtn").on("click",function(e){e.preventDefault(),popup.protocolLayer("投资授权协议","/about/invest_sign_pc")}),$("#serverProtocolBtn").on("click",function(e){e.preventDefault(),popup.protocolLayer("多啦聚财咨询服务协议","/about/service")}),$("#registerProtocolBtn").on("click",function(e){e.preventDefault(),popup.protocolLayer("多啦聚财注册服务协议","/about/register")}),$("#riskBnt").on("click",function(e){e.preventDefault(),popup.protocolLayer("风险提示书","/about/risk")})}})},telAuthenticationPage:function(){var e=$.cookie("mobile");$("#userTel").text(e)},telChangePage:function(){$("#getCode").on("click",function(e){e.preventDefault();var t=$("#userTel").val();user.getUnionSendAuthCode({mobile:t,transactionType:"update_mobile",callback:function(e){layer.msg("发送成功！");var t=(new Date).getTime(),a=t+59e3;util.countdown(a,t,function(e,t,a){var n=e[3]<10?"0"+e[3]:e[3];n<=0?layui.$("#getCode").text("获取验证码").attr("disabled",!1).removeClass("is-disabled"):layui.$("#getCode").text(n+"s后重新获取").attr("disabled",!0).addClass("is-disabled")})}})}),form.on("submit(changeTelFrom)",function(e){var t=e.field;return user.unionChangeMobile({mobile:t.user_tel,authCode:t.user_code,transactionType:"update_mobile",callback:function(e){popup.changePassLayer("手机号修改成功",function(e,t){$.cookie("token",null,{expires:0,path:"/"}),$.cookie("mobile","",{expires:0,path:"/"}),$.cookie("user_type","",{expires:0,path:"/"}),window.location.href=path.debtorLoginUrl})}}),!1})},passChangePage:function(){form.on("submit(changePassFrom)",function(e){var t=e.field;return/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,16}$/.test(t.new_pass)?user.unionUpdatePassword({oldPassword:t.now_pass,newPassword:t.new_pass,newPasswordRe:t.re_new_pass,callback:function(e){popup.changePassLayer("密码修改成功",function(e,t){$.cookie("token",null,{expires:0,path:"/"}),$.cookie("mobile","",{expires:0,path:"/"}),$.cookie("user_type","",{expires:0,path:"/"}),window.location.href=path.debtorLoginUrl})}}):layer.msg("新密码为8-16位字母与数字的组合!"),!1})},msgPage:function(){function a(e){var t=function(e){var t="",a=e.length;if(0<a)for(var n=0;n<a;n++){if(e[n].is_read)var i="is-ready";else var i="";t+='<div class="layui-colla-item '+i+'" data-id="'+e[n].id+'" data-isRead="'+e[n].is_read+'"><h2 class="layui-colla-title clearfix"><span class="msg-tit">'+e[n].subject+'</span><span class="msg-time fr">'+e[n].time+'</span></h2><div class="layui-colla-content">'+e[n].content+"</div></div>"}else t='<div class="empty empty-div"><span>空空如也...</span></div>';return t}(e.list);$("#userMsgList").empty().append(t),form.render(),element.render()}user.getNotes({page:1,pageSize:10,callback:function(e){var t;console.log(e),userNavInfo(e.user),a(e),1<(t=e).maxPage&&laypage.render({elem:"noticePage",count:t.total,limit:t.limit,groups:10,layout:["prev","page","next","skip"],theme:"#ff6600",jump:function(e,t){t||user.getNotes({page:e.curr,pageSize:e.limit,callback:function(e){a(e)}})}})}}),$("body").on("click","#userMsgList .layui-colla-item",function(){var e=$(this).data("isread"),t=$(this).data("id");$(this).addClass("is-ready"),$(this).find(".layui-form-checkbox").addClass("layui-form-checked"),e||user.isReadyNotice({ids:t,callback:function(e){}})}),form.on("submit(checkReady)",function(e){user.isReadyNotice({ids:"all",callback:function(e){window.location.reload()}})})},balanceReturnPage:function(){function m(e){return 0<e&&e<=6?"8.0":7<=e&&e<=12?"9.0":13<=e&&e<=18?"10.0":19<=e&&e<=24?"10.6":25<=e&&e<=36?"11.0":void 0}user.balanceInfo({callback:function(e){var t,l;console.log(e),userNavInfo(e.user),function(e){var t=e.balance_info,a=e.balance_sys_conf;if(t&&1===t.status){$("#isOpenBalance").val(1),$("#userMinDate").val(t.period_min),$("#userMaxDate").val(t.period_max),$("#userHoleMoney").val(t.hold_money);var n=$("input[name='switch']").prop("checked");$("input[name='switch']").prop("checked",!n),form.render("checkbox"),$("#balanceTips").hide(),$("#setBalaceForm").show()}else $("#isOpenBalance").val(0);t&&($("#holdMoney").val(t.hold_money),$("#balanceSuccessMoney").text(t.balance_total_money));for(var i="",s="",r=t.period_min,o=t.period_max,l=1*a.period_min,c=1*a.period_max,d=l;d<=c;d++){if(d===1*r)var u="selected";else var u="";if(d===1*o)var p="selected";else var p="";if(c<o&&d===c)var p="selected";i+='<option value="'+d+'" '+u+">"+d+"个月</option>",s+='<option value="'+d+'" '+p+">"+d+"个月</option>"}$("#minPeriod").empty().append(i),$("#maxPeriod").empty().append(s),form.render("select");var f=m(r),b=m(o);$("#minRate").html(f),$("#maxRate").html(b)}(e),t=e.balance_info.status,l=e.user,1===t?form.on("switch(open_form)",function(e){e.elem.checked?($("#balanceForm").removeClass("is-visibility"),$("#balanceProtocol").removeClass("is-visibility"),$("#balanceBtn").show(),$("#closeBtn").hide().removeClass("is-success")):($("#balanceForm").addClass("is-visibility"),$("#balanceProtocol").addClass("is-visibility"),$("#balanceBtn").hide(),$("#closeBtn").show().addClass("is-success"))}):form.on("switch(open_form)",function(e){var t=l.whether_evaluation,a=l.srbank.is_srbank_user_bindcard,n=l.bankcard_status,i=l.srbank.is_srbank_user,s=l.srbank.need_reset_pwd_first,r=(l.srbank.is_srbank_user_bindcard,l.srbank.is_srbank_user_sign_auto_bid),o=l.srbank.is_srbank_user_sign_credit_transfer;bank.validateBank({validata:{signAutoBid:!0,signCreditTransfer:!0,signTransfer:!1,whetherEvaluation:!0},isSrbankUser:i,srbankUserCallback:function(){popup.bankTipLayer("INVESTOR")},isSrbankUserBindcard:a,bankcardStatus:n,bindCardCallback:function(){popup.bankBindCardLayer("开启复投")},needResetPwdFirst:s,resetPWDCallback:function(){alert("重置密码!")},isSrbankUserSignAutoBid:r,signAutoBidCallback:function(){popup.signLayer("开启投资授权协议签约",'<p class="text">您还未开启<a href="javascript:;" >《投资授权协议》</a>中的“自动投标签约”，请先进行签约再进行投资',"sign_auto_bid")},isSrbankUserSignCreditTransfer:o,signCreditTransferCallback:function(){popup.signLayer("开启投资授权协议签约",'<p class="text">您还未开启<a href="javascript:;" >《投资授权协议》</a>中的“自动购买债权签约”，请先进行签约再进行投资</p>',"sign_credit_transfer")},isWhetherEvaluation:t,whetherEvaluationCallback:function(){layer.alert("您还未进行风险测评，请先进行风险测评!",{yes:function(){window.location.href=path.investorSetting,layer.closeAll()}})},validataSuccessCallback:function(){e.elem.checked?($("#balanceTips").hide(),$("#setBalaceForm").show()):($("#setBalaceForm").hide(),$("#balanceTips").show())}})})}}),$("#holdMoney").on("input",function(){$(this).val()&&$("#balanceBtn").addClass("is-success")}),form.on("select(leftSelect)",function(e){e.value&&$("#balanceBtn").addClass("is-success");var t=m(e.value);$("#minRate").text(t)}),form.on("select(rightSelect)",function(e){e.value&&$("#balanceBtn").addClass("is-success");var t=m(e.value);$("#maxRate").text(t)}),form.on("submit(saveSet)",function(e){var t=e.field,a=$("#selectProtocol").hasClass("is-select"),n=1*$("#userMinDate").val(),i=1*$("#userMaxDate").val(),s=1*$("#userHoleMoney").val(),r=t.start_date,o=t.end_date;if(1*r===n&&1*o===i&&1*t.save_money===s)return layer.msg("没有修改，无需提交!"),!1;if(a){if(1*o<1*r)return layer.msg("投资期限区间选择错误!"),!1;user.balanceOpen({holdMoney:t.save_money,periodMin:r,periodMax:o,callback:function(e){1*$("#isOpenBalance").val()==1?layer.msg("修改设置成功",function(){window.location.reload()}):layer.msg("设置成功",function(){window.location.reload()})}})}else layer.tips("请同意协议！","#balanceBtn",{tips:1});return!1}),form.on("submit(closeSet)",function(e){e.field,$("#selectProtocol").hasClass("is-select");return user.balanceClose({callback:function(e){layer.msg("已为您关闭余额自动复投",function(){window.location.reload()})}}),!1}),$("#selectProtocol").on("click",function(e){e.preventDefault();var t=$(this),a=$("#balanceBtn");t.hasClass("is-select")?(t.removeClass("is-select"),a.removeClass("is-success")):(t.addClass("is-select"),a.addClass("is-success"))}),$("#invest_protocol").on("click",function(e){e.preventDefault(),popup.investProtocolLayer("invest")}),$("#balanceRule").on("click",function(e){e.preventDefault();layer.open({type:1,content:'<dl class="rule-contanier"><dt class="rule-tit">余额自动投标排队规则说明：</dt><dd class="rule-text">按照开启时间先后顺序进行排队，以下几种情况会导致重新排队：</dd><dd class="rule-text">1、关闭余额自动复投后重新开启。</dd><dd class="rule-text">2、修改余额自动复投设置。</dd></dl><dl class="rule-contanier"><dt class="rule-tit">自动投标与设置说明：</dt><dd><dl class="rule-contanier--seconed"><dt class="rule-text">【账户保留余额】</dt><dd class="rule-text">账户可用余额减去账户保留余额可用于自动投标；若账户保留余额为0时，则账户全部可用余额可用于自动投标；若账户可用余额减去账户保留余额小于起投金额100元，不会触发自动投标机制。</dd><dt class="rule-text">【投标期限】</dt><dd class="rule-text">出借人选择的期限范围，具体以每个实际匹配的项目期限为准。</dd><dt class="rule-text">【投资利率】</dt><dd class="rule-text">实际利率具体以每个匹配的项目往期参考利率为准。</dd><dt class="rule-text">【投标范围】</dt><dd class="rule-text">平台所有可投标的。</dd><dt class="rule-text">【回款方式】</dt><dd class="rule-text">等额本息。</dd><dt class="rule-text">【投资管理费说明】</dt><dd class="rule-text">具体以每个实际匹配的项目投资管理费为准。</dd><dt class="rule-text">【转让说明】</dt><dd class="rule-text">具体以每个实际匹配的项目转让方式为准。</dd><dt class="rule-text">【垫息说明】</dt><dd class="rule-text">投标项目为债转项目时，需将转让人本期持有天数所得收益垫付给转让人，垫付利息会在最近一次回款日返回至您的账户。</dd></dl></dd></dl>',area:["630px","560px"],title:"规则说明",skin:"balance-rule-layer",resize:!1,move:!1})})}})});